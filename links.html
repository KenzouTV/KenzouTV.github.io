<script>
/* === links.full.js === */
(function(){
  const topbar = document.querySelector('nav.topbar');
  if (!topbar) return;
  document.querySelectorAll('.nav-overlay, .overlay-inner').forEach(n => n.remove());
  const navlinks = topbar.querySelector('.navlinks');
  if (!navlinks) return;

  // burger + mobile menu
  let burger = document.getElementById('burger');
  if (!burger) {
    burger = document.createElement('button');
    burger.id = 'burger';
    burger.setAttribute('aria-expanded','false');
    burger.setAttribute('aria-controls','main-nav');
    burger.setAttribute('aria-label','Ouvrir le menu');
    burger.innerHTML = '<span class="bar" aria-hidden="true"></span><span class="bar" aria-hidden="true"></span><span class="bar" aria-hidden="true"></span>';
    topbar.appendChild(burger);
  }
  let mobileMenu = topbar.querySelector('.mobile-menu');
  if (!mobileMenu){
    mobileMenu = document.createElement('div');
    mobileMenu.className = 'mobile-menu';
    mobileMenu.setAttribute('role','menu');
    topbar.appendChild(mobileMenu);
  }
  function rebuildMobileMenu(){
    mobileMenu.innerHTML = '';
    navlinks.querySelectorAll('a, button').forEach(node=>{
      if (node.tagName.toLowerCase() === 'a') {
        const a = document.createElement('a');
        a.href = node.getAttribute('href') || '#';
        a.innerHTML = node.innerHTML;
        if (node.classList.contains('active')) a.classList.add('active');
        if (a.href.startsWith('http')) { a.setAttribute('target','_blank'); a.setAttribute('rel','noopener'); }
        a.addEventListener('click', ()=> closeMobileMenu());
        mobileMenu.appendChild(a);
      } else {
        const b = document.createElement('button');
        b.innerHTML = node.innerHTML;
        if (node.id) b.id = node.id + '-mobile';
        b.addEventListener('click', ()=>{
          if (node.id === 'btnDiscord' || node.classList.contains('btn-discord')) {
            window.open('https://discord.gg/KURpXHzRTE','_blank','noopener');
            closeMobileMenu();
          } else {
            try { node.click(); } catch(e){}
            closeMobileMenu();
          }
        });
        mobileMenu.appendChild(b);
      }
    });
  }
  function openMobileMenu(){ rebuildMobileMenu(); mobileMenu.classList.add('open'); burger.setAttribute('aria-expanded','true'); const first = mobileMenu.querySelector('a, button'); if (first) first.focus(); document.documentElement.style.overflow='hidden'; document.body.style.overflow='hidden'; }
  function closeMobileMenu(){ mobileMenu.classList.remove('open'); burger.setAttribute('aria-expanded','false'); document.documentElement.style.overflow=''; document.body.style.overflow=''; burger.focus(); }
  burger.addEventListener('click', (e)=> { e.stopPropagation(); mobileMenu.classList.contains('open') ? closeMobileMenu() : openMobileMenu(); });
  document.addEventListener('click', (e)=> { if (!mobileMenu.contains(e.target) && !burger.contains(e.target)) closeMobileMenu(); });
  window.addEventListener('keydown', (e)=> { if (e.key === 'Escape') closeMobileMenu(); });
  function checkNavOverflow(){ if (window.innerWidth >= 880) { topbar.classList.remove('compact'); return; } const tbRect = topbar.getBoundingClientRect(); const navRect = navlinks.getBoundingClientRect(); const marginRight = 60; const overflows = (navRect.right > (tbRect.right - marginRight)) || (navlinks.scrollWidth > navlinks.clientWidth); if (overflows) topbar.classList.add('compact'); else topbar.classList.remove('compact'); }
  window.addEventListener('load', ()=> setTimeout(checkNavOverflow,60));
  window.addEventListener('resize', ()=> setTimeout(checkNavOverflow,40));
  if (window.ResizeObserver){ const ro = new ResizeObserver(checkNavOverflow); ro.observe(navlinks); ro.observe(topbar); }
  checkNavOverflow();

  // COPY + TOAST
  const toast = document.getElementById('toast');
  function showToast(text='Copié !'){ if (!toast) return; toast.textContent = text; toast.style.display = 'block'; toast.style.opacity = '1'; setTimeout(()=> { toast.style.transition = 'opacity 400ms'; toast.style.opacity = '0'; setTimeout(()=> toast.style.display = 'none', 420); }, 900); }

  document.querySelectorAll('.link-card').forEach(card=>{
    const url = card.getAttribute('data-url') || '#';
    const openBtn = card.querySelector('[data-open]');
    if (openBtn){
      openBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        window.open(url, '_blank', 'noopener');
      });
    }
    const copyBtn = card.querySelector('[data-copy]');
    if (copyBtn){
      copyBtn.addEventListener('click', async (e)=>{
        e.preventDefault();
        try {
          await navigator.clipboard.writeText(url);
          showToast('Lien copié !');
        } catch (err) {
          const ta = document.createElement('textarea');
          ta.value = url;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          ta.remove();
          showToast('Lien copié !');
        }
      });
    }
  });

  // Discord quick button
  const btnDiscord = document.getElementById('btnDiscord');
  if (btnDiscord) btnDiscord.addEventListener('click', ()=> window.open('https://discord.gg/KURpXHzRTE','_blank','noopener'));
  document.querySelectorAll('a[href^="http"]').forEach(a => { a.setAttribute('target','_blank'); a.setAttribute('rel','noopener'); });

})();
</script>
